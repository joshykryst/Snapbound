<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Photos - SnapBound</title>
    <link rel="stylesheet" href="picture.css">
</head>
<body>
    <div class="select-photos-container">
        <h2>Choose Your Strip Style</h2>
        <div class="strip-options">
            <div class="strip-preview" data-color="Red">
                <img src="Photo/Red.png" alt="Red Strip">
            </div>
            <div class="strip-preview" data-color="Blue">
                <img src="Photo/Blue.png" alt="Blue Strip">
            </div>
            <div class="strip-preview" data-color="Green" style="background-color: #2ecc71;">
                <div class="photo-placeholder"></div>
                <div class="photo-placeholder"></div>
                <div class="photo-placeholder"></div>
                <div class="photo-placeholder"></div>
            </div>
            <div class="strip-preview" data-color="Yellow">
                <img src="Photo/Yellow.png" alt="Yellow Strip">
            </div>
            <div class="strip-preview" data-color="Purple">
                <img src="Photo/Purple.png" alt="Purple Strip">
            </div>
            <div class="strip-preview" data-color="Copper">
                <img src="Photo/Copper.png" alt="Copper Strip">
            </div>
            <div class="strip-preview" data-color="White">
                <img src="Photo/White.png" alt="White Strip">
            </div>
        </div>

        <h2>Choose Photo Effect</h2>
        <div class="effect-options">
            <button class="effect-btn active">Normal</button>
            <button class="effect-btn">Black & White</button>
            <button class="effect-btn">Sepia</button>
            <button class="effect-btn">Vintage</button>
            <button class="effect-btn">High Contrast</button>
        </div>

        <div class="photos-grid" id="photosGrid">
            <!-- Photos will be loaded here -->
        </div>

        <div class="selection-controls">
            <button id="downloadPhotos">Download Photos</button>
            <button id="downloadStrip">Download PhotoStrip</button>
        </div>
    </div>

    <style>
        .strip-options {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 20px 0;
            margin-bottom: 30px;
            justify-content: center;
        }

        .strip-preview {
            flex: 0 0 auto;
            width: 120px;
            height: 400px;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .photo-placeholder {
            width: 100%;
            height: 80px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .photo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .strip-preview[data-color="Red"] { background-color: #ff4757; }
        .strip-preview[data-color="Blue"] { background-color: #2e86de; }
        .strip-preview[data-color="Green"] { background-color: #2ecc71; }
        .strip-preview[data-color="Yellow"] { background-color: #ffd32a; }
        .strip-preview[data-color="Purple"] { background-color: #8e44ad; }
        .strip-preview[data-color="Copper"] { background-color: #cd7f32; }
        .strip-preview[data-color="White"] { background-color: #f1f2f6; }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .photo-container {
            position: relative;
            aspect-ratio: 3/4;
            border-radius: 8px;
            overflow: hidden;
        }

        .photo-checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            transform: scale(1.5);
            z-index: 2;
            cursor: pointer;
        }

        .selection-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .selection-controls button {
            padding: 12px 24px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .effect-options {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .effect-btn {
            padding: 8px 16px;
            border: 2px solid #ff4757;
            background: transparent;
            color: #ff4757;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .effect-btn.active {
            background: #ff4757;
            color: white;
        }
    </style>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    const photosGrid = document.getElementById('photosGrid');
    const capturedImages = JSON.parse(localStorage.getItem('capturedImages')) || [];
    let selectedPhotos = [];
    const MAX_PHOTOS = 4;

    // Display captured images with checkboxes
    capturedImages.forEach((imageData, index) => {
        const imgContainer = document.createElement('div');
        imgContainer.className = 'photo-container';
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'photo-checkbox';
        checkbox.id = `photo-${index}`;
        
        checkbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                if (selectedPhotos.length >= MAX_PHOTOS) {
                    e.target.checked = false;
                    alert('You can only select 4 photos!');
                    return;
                }
                selectedPhotos.push({index, src: imageData});
                updateStripPreviews();
            } else {
                selectedPhotos = selectedPhotos.filter(photo => photo.index !== index);
                updateStripPreviews();
            }
        });
        
        const img = document.createElement('img');
        img.src = imageData;
        
        imgContainer.appendChild(checkbox);
        imgContainer.appendChild(img);
        photosGrid.appendChild(imgContainer);
    });

    // Function to update strip previews with selected photos
    function updateStripPreviews() {
        document.querySelectorAll('.strip-preview').forEach(strip => {
            const placeholders = strip.querySelectorAll('.photo-placeholder');
            placeholders.forEach((placeholder, index) => {
                placeholder.innerHTML = ''; // Clear existing content
                if (selectedPhotos[index]) {
                    const img = document.createElement('img');
                    img.src = selectedPhotos[index].src;
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    placeholder.appendChild(img);
                }
            });
        });
    }

    // Update strip styles
    document.querySelectorAll('.strip-preview').forEach(strip => {
        strip.innerHTML = '';
        // Create 4 placeholder slots
        for (let i = 0; i < 4; i++) {
            const placeholder = document.createElement('div');
            placeholder.className = 'photo-placeholder';
            strip.appendChild(placeholder);
        }
    });
});

// Update the createPhotoStrip function
async function createPhotoStrip(images) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    // Set photostrip dimensions to match the template
    canvas.width = 400;  // Adjusted width
    canvas.height = 1200; // Adjusted height for 4 photos
    
    try {
        // Draw background color based on selected strip
        ctx.fillStyle = selectedStrip.toLowerCase();
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Draw border (white frame)
        ctx.strokeStyle = 'white';
        ctx.lineWidth = 20;
        ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
        
        // Calculate dimensions for photos
        const photoWidth = 360;  // Slightly smaller than canvas for margins
        const photoHeight = 270; // Maintaining aspect ratio
        const xOffset = (canvas.width - photoWidth) / 2;
        const yGap = 20; // Gap between photos
        
        // Draw each photo
        for (let i = 0; i < images.length; i++) {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            await new Promise((resolve, reject) => {
                img.onload = resolve;
                img.onerror = reject;
                img.src = images[i];
            });
            
            // Calculate Y position for each photo
            const yOffset = 30 + (i * (photoHeight + yGap));
            
            // Draw white border around each photo
            ctx.fillStyle = 'white';
            ctx.fillRect(xOffset - 5, yOffset - 5, photoWidth + 10, photoHeight + 10);
            
            // Draw the photo
            ctx.drawImage(img, xOffset, yOffset, photoWidth, photoHeight);
            
            // Apply selected effect
            if (selectedEffect !== 'normal') {
                const imageData = ctx.getImageData(xOffset, yOffset, photoWidth, photoHeight);
                applyEffectToImageData(imageData, selectedEffect);
                ctx.putImageData(imageData, xOffset, yOffset);
            }
        }
        
        // Add watermark or branding
        ctx.fillStyle = 'white';
        ctx.font = 'bold 24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('SnapBound', canvas.width / 2, canvas.height - 30);
        
        // Download the final strip
        const link = document.createElement('a');
        link.download = `photostrip-${selectedStrip.toLowerCase()}.jpg`;
        link.href = canvas.toDataURL('image/jpeg', 0.8);
        link.click();
        
    } catch (error) {
        console.error('Error creating photo strip:', error);
        alert('Error creating photo strip. Please try again.');
    }
}

// Update the strip preview styles
    </script>
</body>
</html>